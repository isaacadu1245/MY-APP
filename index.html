<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bangerhitz Digital Media</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <main class="p-6 max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-center text-yellow-400">Bangerhitz Digital Media</h1>
    <p class="text-center mb-6">Affordable No-Expiry Data Plans</p>

    <!-- Plans -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-yellow-400 text-xl font-bold mb-2">MTN</h2>
        <ul>
          <li class="cursor-pointer hover:bg-yellow-700 p-2 rounded" data-plan="1GB" data-price="7" data-network="MTN">1GB - GHC 7</li>
          <li class="cursor-pointer hover:bg-yellow-700 p-2 rounded" data-plan="5GB" data-price="26" data-network="MTN">5GB - GHC 26</li>
        </ul>
      </div>

      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-blue-400 text-xl font-bold mb-2">AT</h2>
        <ul>
          <li class="cursor-pointer hover:bg-blue-700 p-2 rounded" data-plan="1GB" data-price="6" data-network="AT">1GB - GHC 6</li>
        </ul>
      </div>

      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-red-400 text-xl font-bold mb-2">Telecel</h2>
        <ul>
          <li class="cursor-pointer hover:bg-red-700 p-2 rounded" data-plan="5GB" data-price="26" data-network="Telecel">5GB - GHC 26</li>
        </ul>
      </div>
    </div>

    <!-- Payment Form -->
    <div id="transaction-form" class="hidden mt-8 bg-gray-800 p-6 rounded-lg">
      <h2 class="text-xl font-bold mb-4">Purchase Data Bundle</h2>
      <p id="selected-plan-text" class="text-yellow-400 mb-4"></p>

      <form id="payment-form" class="space-y-4">
        <div>
          <label class="block">Your Phone Number (Buyer):</label>
          <input type="tel" id="buyer-number" class="w-full p-2 rounded bg-gray-700 border border-gray-600" required>
        </div>
        <div>
          <label class="block">Recipientâ€™s Phone Number:</label>
          <input type="tel" id="recipient-number" class="w-full p-2 rounded bg-gray-700 border border-gray-600" required>
        </div>
        <button type="submit" class="w-full bg-yellow-500 text-black font-bold py-3 rounded">Proceed to Payment</button>
      </form>
      <div id="message-box" class="mt-4 hidden p-2 rounded"></div>
    </div>
  </main>

  <script>
    let selectedPlan = null;
    let selectedPrice = null;
    let selectedNetwork = null;

    document.querySelectorAll("li[data-plan]").forEach(item => {
      item.addEventListener("click", () => {
        selectedPlan = item.dataset.plan;
        selectedPrice = item.dataset.price;
        selectedNetwork = item.dataset.network;

        document.getElementById("selected-plan-text").textContent =
          `${selectedNetwork} ${selectedPlan} - GHC ${selectedPrice}`;
        document.getElementById("transaction-form").classList.remove("hidden");
        document.getElementById("transaction-form").scrollIntoView({ behavior: "smooth" });
      });
    });

    document.getElementById("payment-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const buyerNumber = document.getElementById("buyer-number").value;
      const recipientNumber = document.getElementById("recipient-number").value;

      const payload = {
        amount: selectedPrice,
        buyerNumber,
        recipientNumber,
        plan: `${selectedNetwork} ${selectedPlan}`
      };

      const response = await fetch("/initialize-payment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await response.json();
      if (data.status) {
        window.location.href = data.data.authorization_url;
      } else {
        const msgBox = document.getElementById("message-box");
        msgBox.textContent = "Payment initialization failed.";
        msgBox.classList.remove("hidden");
        msgBox.classList.add("bg-red-500");
      }
    });
  </script>
</body>
</html>
